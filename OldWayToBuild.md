# Old way - for pjsip-1.x not anymore supported for CSipSimple #

**WARNING** : This method **ONLY** works for [revision 1108](https://code.google.com/p/csipsimple/source/detail?r=1108) or lower. **DON'T TRY WITH LATEST SVN!**

# Build the pjsip library for android #

First thing to do :
Create a new directory for the project.

## Get the NDK and the source ##
The svn does not contains the build toolchain for android.
The one distributed in CSipSimple SVN is a mix between Crystax NDK and a NDK that allow to build for armv4t devices (thx to H. Manson).
(For reference [crystax NDK](http://www.crystax.net/android/ndk-r4.php) and [android armv4t NDK](http://code.google.com/p/android-on-freerunner/issues/detail?id=142).

You can now also use the official android ndk r5b since it support C++ (if you try to build with opensl-ES you must use it).

  * First of all get the ndk and unzip
EITHER :


  * Official android NDK:
```
wget http://dl.google.com/android/ndk/android-ndk-r6-linux-x86.tar.bz2
tar -xvf android-ndk-r6-linux-x86.tar.bz2
mv android-ndk-r6 pjsip_android
cd pjsip_android/
# Get only the relevant part of the svn
svn checkout http://csipsimple.googlecode.com/svn/trunk/pjsip_android/apps apps
cd ../../
```


**FOLLOWING METHOD SHOULD NOT BE USED, UNLESS YOU KNOW WHY YOU WANTS TO USE IT**
  * Crystax NDK :
```
wget http://www.crystax.net/data/android-ndk-r4-linux-x86-crystax-4.tar.bz2
tar -xvf android-ndk-r4-linux-x86-crystax-4.tar.bz2
rm android-ndk-r4-linux-x86-crystax-4.tar.bz2
# Checkout the pjsip part of the project
svn checkout http://csipsimple.googlecode.com/svn/trunk/pjsip_android pjsip_android
# Now we have to add the ndk toolchains into the pjsip_android project ndk.
cp -r android-ndk-r4-crystax/build/prebuilt pjsip_android/build/
```
_Note : You can now delete the android-ndk-[r4](https://code.google.com/p/csipsimple/source/detail?r=4)-crystax folder_

  * Armv4t NDK :
```
# Checkout the pjsip part of the project
svn checkout http://csipsimple.googlecode.com/svn/trunk/pjsip_android pjsip_android
cd pjsip_android/build
# Get the NDK prebuilt
wget http://nightlies.csipsimple.com/tools/prebuilt.tar.gz
tar -xvf prebuilt.tar.gz
rm prebuilt.tar.gz
cd ../../
```


_Note : the source is also available in a [Bazar mirror](https://code.launchpad.net/csipsimple/+branches?field.lifecycle=DEVELOPMENT&field.lifecycle-empty-marker=1&field.sort_by=by+owner+name&field.sort_by-empty-marker=1)_

## Build the library ##

  * Go into the pjsip\_android directory:
```
cd pjsip_android
```

  * Launch a make (but it will generate only one target lib)
```

make APP=pjsip
#if you want to build for target android 2.3 (for OpenSL-ES support type or webRTC support ) :
# WARNING : default of webRTC is now activated !! so you should consider use this line instead :  

make APP=pjsip TARGET_PLATFORM=android-9
```

Congratulation you've just build the dynamic library.
You can find your build under

```
../CSipSimple/libs/armeabi & armeabi-v7a
```

## Customize your builds ##

pjsip\_android can be built with several build flags to activate/deactivate some features.
The file that allow you to say what you'd like to build is in :
pjsip\_android/apps/pjsip/Application.mk

You can here choose :
  * The output dir of your libs with APP\_PROJECT\_PATH := ....your\_directory.....
  * The target abi you'd like to build with APP\_ABI depending the NDK you choose available are : armeabi, armeabi-v7a, armv4t. (You can combine eabi and eabi-v7a targets separating with space. armv4t that must be built alone).
  * Codecs you want to build with MY\_USE\_G729|SILK|SPEEX|G722|GSM|CODEC2 := 1 (if you want to enable it) 0 (if you don't).
SPEEX codec should always be 1 if you build for armv7a cause it is required for AEC.
  * TLS/ZRTP support with MY\_USE\_TLS := 1
  * Android audio dev backend with MY\_ANDROID\_DEV := 1 (for a backend that relies on java API and is compatible from android 1.5) 2 (for the new OpenSL-ES backend. it uses the new android native audio API and require to build for target android-9 and will be compatible only with devices that has android 2.3 or upper).
In the future we plan to make it more modular so that it will be possible to make builds that can rely on java or/and opensl api.
Also when OpenSL-ES api will allow it, it will be possible to have direct encoding capabilities (amr / gsm) from the device. (For now it's not allowed by OpenSL-ES api...)


# Build the android application #
From the android sdk point of view, the application is a standard android application.

So you can use eclipse.
Checkout the csipsimple directory (under trunk) from the source. (You can use [Subclipse](http://subclipse.tigris.org/) to checkout directly into Eclipse).

  * If you have build the pjsip library, copy the .so generated by the build in the directories : `libs/armeabi/libpjsipjni.so` and `libs/armeabi-v7a/libpjsipjni.so` of the android project.
  * Alternatively, you can use **nightly builds** to extract from apk the .so files and then put the files in the correct directory. In this case you **MUST** be sure that the nightly build version is the same than your SVN version !!!

The project has to be imported as an android project (with sdk 2.3).<br />
The project is compatible with android 1.5 but different layout support is available only after 1.6 and some features of manifest file after 2.3.

Then you can launch the project using run (and choose your remote device or a virtual device _(emulator)_).

If you are running something different than a Linux or MacOS or with a platform without svn properly configured, you will experiment problems with the auto svn tagger tool for android manifest.
In this case remove the .externalTools dir from the CSipSimple project and revert the Manifest file from the version available on the repository.

It's deeply advised to not make audio tests using the emulator cause the audio driver of the qemu is really bad and leads to pledging CPU of the emulator.

If you experiments problems at first run use _Project > Clean ..._